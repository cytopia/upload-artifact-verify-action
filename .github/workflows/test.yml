---
name: test
on:
  pull_request:

jobs:
  test01:
    name: test normal
    runs-on: ubuntu-latest
    steps:

      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Create artifact
        id: file
        shell: bash
        run: |
          PRE_RAND="$( ${RAND} | md5sum | head -c 20;  )"
          PRE_DATE="$( date '+%s' )"
          NAME="${PRE_RAND}-${PRE_DATE}.txt"
          echo "somedata" > "${NAME}"
          echo "::set-output name=path::${NAME}"

      - name: upload artifact
        uses: ./
        with:
          name: ${{ steps.file.outputs.path }}
          path: ${{ steps.file.outputs.path }}

      - name: download  artifact
        uses: actions/download-artifact@v3
        with:
          name: ${{ steps.file.outputs.path }}


  test02:
    name: test with retry
    runs-on: ubuntu-latest
    steps:

      - name: Checkout repository
        uses: actions/checkout@v2
        with:
          fetch-depth: 0

      - name: Fail step
        shell: bash
        id: fail
        continue-on-error: true
        run: |
          false

      - name: Success step
        shell: bash
        run: |
          echo "outcome: ${{ steps.fail.outcome }}"
          echo "outcome: ${{ steps.fail.conclusion }}"
          #if: failure() && steps.id.outcome == 'failure'

      - name: Normal step
        shell: bash
        run: |
          echo "true"
